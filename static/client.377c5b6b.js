parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"IVsl":[function(require,module,exports) {
"use strict";window.client=window.client||{};const e=new Request("/status"),t=new Request("/scan"),o=1e3,n=1e3,c=5e3;let s,i,d,r,l;function a(e,t){setTimeout(()=>window.requestAnimationFrame(e),t)}async function u(){try{await fetch("/ping");document.body.classList.remove("noserver")}catch(e){console.error(e),document.body.classList.add("noserver")}a(u,o)}async function m(){try{let o=await fetch(e),n=await o.json();n&&!n.retry&&0!==Object.keys(n).length&&y(n)}catch(t){console.error(t)}a(m,n)}function y(e){let t,o=e.wpa_state,n="COMPLETED"===o;o&&e.ssid&&(t=(t=e.ssid).replace(/\n$/,"")),n&&(d=void 0),l=e,console.log("wifi_ssid",t,"wifi_connected",n),n&&document.body.classList.contains("connecting")&&(document.body.classList.remove("connecting"),document.body.classList.add("checking"),console.log("1")),n?document.body.classList.contains("wifi-connected")||(document.body.classList.add("wifi-connected"),document.body.classList.add("checking"),console.log("2"),r&&clearTimeout(r),r=setTimeout(()=>{r=void 0,document.body.classList.remove("checking"),console.log("3"),n&&!document.body.classList.contains("server-connected")?(document.body.classList.add("contactus"),document.body.classList.add("contactus2")):(document.body.classList.remove("contactus"),document.body.classList.remove("contactus2"),_=0)},15e3)):(document.body.classList.remove("wifi-connected"),document.body.classList.remove("contactus"),document.body.classList.remove("checking"),console.log("4")),document.body.classList.remove("jibo-connected"),document.body.classList.remove("jibo-not-connected"),"jibo_connected"in e&&void 0!==e.jibo_connected&&(e.jibo_connected?document.body.classList.add("jibo-connected"):(document.body.classList.remove("checking"),console.log("5"),document.body.classList.add("jibo-not-connected"))),document.body.classList.remove("internet-connected"),document.body.classList.remove("internet-not-connected"),console.log(e.internet_connected),"internet_connected"in e&&void 0!==e.internet_connected&&(e.internet_connected?document.body.classList.add("internet-connected"):(console.log("6"),document.body.classList.add("internet-not-connected"))),document.body.classList.remove("server-connected"),document.body.classList.remove("server-not-connected"),"server_connected"in e&&void 0!==e.server_connected&&(document.body.classList.remove("checking"),console.log("7"),e.server_connected?document.body.classList.add("server-connected"):document.body.classList.add("server-not-connected")),b(t||s,n,d)}function b(e,t,o){let n=document.querySelector("#connection"),c=document.querySelector("#wifi_connection_none"),d=c.content.firstElementChild.cloneNode(!0);t?(s=e,d=(c=document.querySelector("#wifi_connection_good")).content.firstElementChild.cloneNode(!0),console.log(e,d,d.querySelector("#wifi_ssid")),e&&(d.querySelector("#wifi_ssid").textContent=e),i&&d.querySelector("#wifi_bars").classList.add("bars-"+g(i,!0),"bars-bigger")):o&&(d=(c=document.querySelector("#wifi_connection_error")).content.firstElementChild.cloneNode(!0),e&&(d.querySelector("#wifi_ssid").textContent=e),d.querySelector("#line2").textContent=o),n.replaceChildren(d)}async function f(){try{let o=await fetch(t),n=await o.json();console.log(n),n&&!n.retry&&0!==Object.keys(n).length&&w(n)}catch(e){console.error(e)}a(f,c)}function w(e){let t=document.querySelector("#network_list"),o=document.querySelector("#network_list_entry"),n=[],c=document.createDocumentFragment();i=void 0;try{for(let t=0;t<e.length;t++){let d=e[t],r=d.ssid;if(!r||r.includes("\0")||r.includes("\\x00"))continue;if(r.startsWith("s02-")||r.startsWith("JiboStation"))continue;if(n.includes(r))continue;n.push(r);let l=o.content.firstElementChild.cloneNode(!0);l.querySelector("#wifi_security").textContent=d.security?"🔒":"",l.querySelector("#wifi_bars").classList.add("bars-"+g(d.signal)),l.querySelector("#wifi_ssid").textContent=r,l.addEventListener("click",x),c.appendChild(l),r===s&&(i=d.signal)}}catch(d){console.error(d)}t.replaceChildren(c),C()}function g(e){let t=0;return e>-40?t=3:e>-65?t=2:e>-80&&(t=1),t}function v(e){document.body.classList.contains(e)?document.body.classList.remove(e):document.body.classList.add(e)}function L(e){let t=document.querySelector(e);t&&t.scrollIntoView()}let _=0;async function h(e){console.log(e),console.log(e.target),e.preventDefault();let t=new FormData(e.target),o=t.get("ssid"),n=t.get("password");document.querySelector("#feedback");document.body.classList.add("connecting"),++_>1&&document.body.classList.add("contactus2");try{console.log(t),console.log(t.get("ssid")),console.log(t.get("password"));let e=document.querySelector("#trim_spaces");e&&!e.checked||(console.log("trimming spaces"),o=o.trim(),n=n.trim()),feedback.textContent="Connecting to "+o+"...",d=void 0;let s={ssid:o,password:n};await fetch("/connect",{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}})}catch(c){console.error("error during connect",c)}r=setTimeout(()=>{r=void 0,document.body.classList.contains("connecting")&&(document.body.classList.remove("connecting"),b(o,!1,d="password might be incorrect"),s=o)},1e4)}function p(){r&&(clearTimeout(r),r=void 0,document.body.classList.remove("connecting"))}async function q(){document.body.classList.add("disconnecting"),document.body.classList.remove("contactus");try{let t=new Request("/disconnect",{method:"POST"});fetch(t)}catch(e){console.error("error during disconnect",e)}setTimeout(()=>{document.body.classList.remove("disconnecting")},5e3)}function S(e){let t=document.querySelector("#password");document.querySelector("#visibility");"password"!==t.type?(t.type="password",visibility.textContent="😆"):(t.type="text",visibility.textContent="👁️"),e.preventDefault()}function C(e){console.log("ssid changed");let t=document.querySelector("#ssid"),o=document.querySelector("#trim_spaces"),n=t.value;o&&!o.checked||(n=n.trim());let c=document.querySelectorAll("li");for(let s of c){let e=s.querySelector("#wifi_ssid");e&&(e.textContent===n?(console.log("matched!"),s.classList.add("matched")):s.classList.remove("matched"))}}function k(e){let t=document.querySelector("#connect_wifi_form");setTimeout(()=>{t.scrollIntoView(!1)},500)}function x(e){console.log(e.target);let t=e.target.querySelector("#wifi_ssid"),o=document.querySelector("#ssid"),n=document.querySelector("#password");o.value=t.textContent,C(),password.value="",n.focus()}function j(){document.body.classList.add("shownomatchpanel")}function E(){document.body.classList.add("showinfopanel");let e=document.querySelector("#local_hostname");l&&l.hostname?e.textContent=l.hostname:e.textContent="➖";let t=document.querySelector("#local_ip_address");l&&l.ip_address?t.textContent=l.ip_address:t.textContent="➖";let o=document.querySelector("#rover_ip_address");l&&l.rover_ip_address?o.textContent=l.rover_ip_address:o.textContent="➖"}function T(){document.body.classList.remove("showinfopanel"),document.body.classList.remove("shownomatchpanel")}async function O(){document.querySelector("#connect_wifi_form").addEventListener("submit",h);let e=document.querySelector("#ssid"),t=document.querySelector("#password");e.addEventListener("input",C),t.addEventListener("focus",k),document.querySelector("#clickinfo").addEventListener("click",E);let o=document.querySelectorAll("#dismiss");for(let n of o)n.addEventListener("click",T);u(),m(),f()}window.client.init=O,window.client.cancel_connecting=p,window.client.disconnect_wifi=q,window.client.click_network=x,window.client.toggle_password_visibility=S;
},{}]},{},["IVsl"], null)
//# sourceMappingURL=/client.377c5b6b.js.map